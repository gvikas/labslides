<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Devise and GitHub Branch/PR Workflow</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="theme/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="theme/css/screen.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="theme/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide title">
          <div class="inner">
            
            <header><h1>Devise and GitHub Branch/PR Workflow</h1></header>
            
            
            <section><p><strong>CS290B</strong><br />
Bryce Boe<br />
October 23, 2014</p>
<p>https://github.com/scalableinternetservices/labslides/blob/master/devise.md</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              1/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Devise Setup</h1></header>
            
            
            <section><p>See: <a href="https://github.com/plataformatec/devise">https://github.com/plataformatec/devise</a></p>
<p>Create branch to add authentication (<strong>Start Story Procedure</strong>)</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># Ensure on master and up-to-date (git checkout master, git pull)</span>
git checkout -b auth
</pre></div>
</td></tr></table>
<p>Add to: <strong>Gemfile</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;devise&#39;</span>
</pre></div>
</td></tr></table>
<p>Execute:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre>bundle install
rails generate devise:install
<span class="c"># View/Edit config/initializers/devise.rb</span>
rails g devise user  <span class="c"># recall that &#39;g&#39; is short for generate</span>
<span class="c"># Run the migration</span>
rake db:migrate
<span class="c"># Commit this code</span>
git add .
git commit -m <span class="s2">&quot;[#PTID] Generated devise scaffold user class.&quot;</span>
git push -u origin auth
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              2/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Devise Testing</h1></header>
            
            
            <section><p>Update: <strong>test/fixtures/users.yml</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="l-Scalar-Plain">one</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">one@test.com</span>

<span class="l-Scalar-Plain">two</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">two@test.com</span>
</pre></div>
</td></tr></table>
<p>Execute:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre> <span class="nv">RAILS_ENV</span><span class="o">=</span><span class="nb">test </span>rake db:migrate
 rake <span class="nb">test</span>
 <span class="c"># View Routes</span>
 rake routes
 <span class="c"># Start server</span>
 rails s
</pre></div>
</td></tr></table>
<p>URLS:</p>
<ul>
<li><a href="http://localhost:3000/users/sign_in">http://localhost:3000/users/sign_in</a></li>
<li><a href="http://localhost:3000/users/sign_up">http://localhost:3000/users/sign_up</a></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              3/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Adding a sign in / out link to all pages</h1></header>
            
            
            <section><p>Edit: <strong>app/views/layouts/application.html.erb</strong> (add to end of <em>body</em> tag, for
now)</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="x"> </span><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">user_signed_in?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Log Out&#39;</span><span class="p">,</span> <span class="n">destroy_user_session_path</span><span class="p">,</span>
                <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">confirm</span><span class="p">:</span> <span class="s1">&#39;Are you sure?&#39;</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x"> </span><span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">     </span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Log In&#39;</span><span class="p">,</span> <span class="n">new_user_session_path</span> <span class="cp">%&gt;</span><span class="x"> |</span>
<span class="x">     </span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Sign Up&#39;</span><span class="p">,</span> <span class="n">new_user_registration_path</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x"> </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
<p>Verify functionality</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              4/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Fix Controller Tests</h1></header>
            
            
            <section><p>Execute:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>rake <span class="nb">test</span>
</pre></div>
</td></tr></table>
<p>Observe errors:</p>
<blockquote>
<p>ActionView::Template::Error: undefined method `authenticate' for nil:NilClass</p>
</blockquote>
<p>Edit: <strong>test/test_helper.rb</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ActionController</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="ss">Devise</span><span class="p">:</span><span class="ss">:TestHelpers</span>
<span class="k">end</span>
</pre></div>
</td></tr></table>
<p>Execute:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>rake <span class="nb">test</span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              5/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Commit and Make Pull Request</h1></header>
            
            
            <section><p>Execute (First part of <strong>Finish Story Procedure</strong>):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>git status
git diff
git add .
git commit -m <span class="s2">&quot;[Fix #PTID] Add basic authentication functionality.&quot;</span>
git push <span class="c"># This should _Finish_ the story in PivotalTracker</span>
</pre></div>
</td></tr></table>
<p>Create a pull request from your repo's branch list (the <em>Deliver</em> on PT):</p>
<p><a href="https://github.com/scalableinternetservices/labapp/branches">https://github.com/scalableinternetservices/labapp/branches</a></p>
<p><img alt="New pull request button" src="img/gh_branches.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              6/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Code Review, Test and Merge</h1></header>
            
            
            <section><p>(Final part of <strong>Finish Story Procedure</strong>)</p>
<ul>
<li>Requester should send a teammate the link the the PR on GitHub</li>
<li>Teammate should make comments for any issues, or questions they have on the
  branch</li>
<li>Teammate should checkout and <em>test</em> the branch locally</li>
<li>Requester should respond to any issues</li>
<li>When all of teammate's comments have been addressed, teammate (not requester)
  should merge the PR, and then mark <em>Accept</em> on the story in PT</li>
<li>If the PR cannot automatically be merged, requester needs to <em>rebase</em> from
  <em>master</em> and fix any merge conflicts</li>
<li>May require an additional round of testing to ensure merge did not break
    any existing functionalty (you've been writing tests all along, right?)</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              7/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Enforce Authentication for Comments</h1></header>
            
            
            <section><p><strong>Goal</strong>: Unauthenticated users are redirected to the login page when
attempting to create or edit a comment.</p>
<p>Follow the <strong>Start Story Procedure</strong></p>
<p>Add to <strong>CommentsController</strong>: <strong>app/controllers/comments_controller.rb</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">before_action</span> <span class="ss">:authenticate_user!</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</pre></div>
</td></tr></table>
<h2>Fix CommentsControllerTest <strong>test/controllers/comments_controller_test.rb</strong></h2>
<p>Add the following line to tests for <em>create</em>, <em>edit</em>, <em>new</em>, and _update:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">sign_in</span> <span class="n">users</span><span class="p">(</span><span class="ss">:one</span><span class="p">)</span>
</pre></div>
</td></tr></table>
<p>Add a <em>user</em> relationship for each fixture in <strong>test/fixtures/comments.yml</strong>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nn">...</span>
<span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">one</span>
</pre></div>
</td></tr></table>
<p>Follow the <strong>Finish Story Procedure</strong></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              8/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Associate Comments with Users</h1></header>
            
            
            <section><p><strong>Goal</strong>: Displayed comments should output the name of the user who created the
comment.</p>
<p>Follow the <strong>Start Story Procedure</strong></p>
<p>Create and run the migration:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre>rails g migration AddUserToComments user:references
<span class="c"># Inspect the migration code, then apply</span>
rake db:migrate
</pre></div>
</td></tr></table>
<p>Associate comments with a user and enforce that new/updated comments have a
user (edit: <strong>app/models/comment.rb</strong>)</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">belongs_to</span> <span class="ss">:user</span>
<span class="n">validates</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              9/10
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: devise.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Comments + Users continued</h1></header>
            
            
            <section><h2>Associate the session user when creating a new comment</h2>
<p>Edit <strong>app/controllers/comments_controller.rb</strong>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">before_action</span> <span class="ss">:authenticate_user!</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
  <span class="vi">@comment</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">current_user</span>
</pre></div>
</td></tr></table>
<h2>Show comment <em>authors</em> next to comment messages</h2>
<p>Update: <strong>app/views/comments_comment.html.erb</strong></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="x">&lt;div&gt;(</span><span class="cp">&lt;%=</span> <span class="n">comment</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="k">if</span> <span class="n">comment</span><span class="o">.</span><span class="n">user</span> <span class="cp">%&gt;</span><span class="x">) </span><span class="cp">&lt;%=</span> <span class="n">comment</span><span class="o">.</span><span class="n">message</span> <span class="cp">%&gt;</span><span class="x">&lt;/div&gt;</span>
</pre></div>
</td></tr></table>
<p>Follow the <strong>Finish Story Procedure</strong></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="devise.md">devise.md</a>
            </aside>
            
            <aside class="page_number">
              10/10
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Devise and GitHub Branch/PR Workflow</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">Devise Setup</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">Devise Testing</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">Adding a sign in / out link to all pages</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">Fix Controller Tests</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">Commit and Make Pull Request</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">Code Review, Test and Merge</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">Enforce Authentication for Comments</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">Associate Comments with Users</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">Comments + Users continued</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>